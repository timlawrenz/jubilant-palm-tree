{"repo_name":"brakeman","file_path":"./repos/brakeman/test/apps/rails4/app/controllers/users_controller.rb","start_line":2,"raw_source":"def test_sql_sanitize\n    User.where(\"age > #{sanitize params[:age]}\")\n  end","complexity_score":5.2,"ast_json":"{\"type\":\"def\",\"children\":[\"test_sql_sanitize\",{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"User\"]},\"where\",{\"type\":\"dstr\",\"children\":[{\"type\":\"str\",\"children\":[\"age > \"]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"sanitize\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"params\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"age\"]}]}]}]}]}]}]}","id":"cec5945c-7c52-4e13-8b4d-8fab6df2e3b1"}
{"repo_name":"mastodon","file_path":"./repos/mastodon/app/lib/feed_manager.rb","start_line":197,"raw_source":"def unmerge_from_list(from_account, list)\n    timeline_key        = key(:list, list.id)\n    timeline_status_ids = redis.zrange(timeline_key, 0, -1)\n\n    from_account.statuses.select(:id, :reblog_of_id).where(id: timeline_status_ids).reorder(nil).find_each do |status|\n      remove_from_feed(:list, list.id, status, aggregate_reblogs: list.account.user&.aggregates_reblogs?)\n    end\n  end","complexity_score":21.5,"ast_json":"{\"type\":\"def\",\"children\":[\"unmerge_from_list\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"from_account\"]},{\"type\":\"arg\",\"children\":[\"list\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"timeline_key\",{\"type\":\"send\",\"children\":[null,\"key\",{\"type\":\"sym\",\"children\":[\"list\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"list\"]},\"id\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"timeline_status_ids\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"redis\"]},\"zrange\",{\"type\":\"lvar\",\"children\":[\"timeline_key\"]},{\"type\":\"int\",\"children\":[0]},{\"type\":\"int\",\"children\":[-1]}]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"from_account\"]},\"statuses\"]},\"select\",{\"type\":\"sym\",\"children\":[\"id\"]},{\"type\":\"sym\",\"children\":[\"reblog_of_id\"]}]},\"where\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"id\"]},{\"type\":\"lvar\",\"children\":[\"timeline_status_ids\"]}]}]}]},\"reorder\",{\"type\":\"nil\",\"children\":[]}]},\"find_each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"status\"]}]},{\"type\":\"send\",\"children\":[null,\"remove_from_feed\",{\"type\":\"sym\",\"children\":[\"list\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"list\"]},\"id\"]},{\"type\":\"lvar\",\"children\":[\"status\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"aggregate_reblogs\"]},{\"type\":\"csend\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"list\"]},\"account\"]},\"user\"]},\"aggregates_reblogs?\"]}]}]}]}]}]}]}","id":"380787f5-abed-463c-a991-9171ba7bf4d9"}
{"repo_name":"rails","file_path":"./repos/rails/activesupport/test/test_case_test.rb","start_line":294,"raw_source":"def test_assert_changes_works_with_nil\n    oldval = @object\n\n    retval = assert_changes :@object, from: oldval, to: nil do\n      @object = nil\n    end\n\n    assert_nil retval\n  end","complexity_score":6.1,"ast_json":"{\"type\":\"def\",\"children\":[\"test_assert_changes_works_with_nil\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"oldval\",{\"type\":\"ivar\",\"children\":[\"@object\"]}]},{\"type\":\"lvasgn\",\"children\":[\"retval\",{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"assert_changes\",{\"type\":\"sym\",\"children\":[\"@object\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"from\"]},{\"type\":\"lvar\",\"children\":[\"oldval\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"to\"]},{\"type\":\"nil\",\"children\":[]}]}]}]},{\"type\":\"args\",\"children\":[]},{\"type\":\"ivasgn\",\"children\":[\"@object\",{\"type\":\"nil\",\"children\":[]}]}]}]},{\"type\":\"send\",\"children\":[null,\"assert_nil\",{\"type\":\"lvar\",\"children\":[\"retval\"]}]}]}]}","id":"06d891a8-8511-41c9-9062-328c24fd4767"}
{"repo_name":"fluentd","file_path":"./repos/fluentd/lib/fluent/plugin/storage_local.rb","start_line":105,"raw_source":"def multi_workers_ready?\n        unless @multi_workers_available\n          log.error \"local plugin storage with multi workers should be configured to use directory 'path', or system root_dir and plugin id\"\n        end\n        @multi_workers_available\n      end","complexity_score":3.4,"ast_json":"{\"type\":\"def\",\"children\":[\"multi_workers_ready?\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@multi_workers_available\"]},null,{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"log\"]},\"error\",{\"type\":\"str\",\"children\":[\"local plugin storage with multi workers should be configured to use directory 'path', or system root_dir and plugin id\"]}]}]},{\"type\":\"ivar\",\"children\":[\"@multi_workers_available\"]}]}]}","id":"c9479c32-6c5d-4fb9-9fc5-d54303ae5b7a"}
{"repo_name":"discourse","file_path":"./repos/discourse/spec/system/page_objects/components/about_page_site_activity_item.rb","start_line":23,"raw_source":"def has_1_day_period?\n        period_element.has_text?(I18n.t(\"js.about.activities.periods.today\"))\n      end","complexity_score":3.4,"ast_json":"{\"type\":\"def\",\"children\":[\"has_1_day_period?\",{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"period_element\"]},\"has_text?\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"I18n\"]},\"t\",{\"type\":\"str\",\"children\":[\"js.about.activities.periods.today\"]}]}]}]}","id":"1fce84a8-f665-4c5e-8397-0ff1e82f20b2"}
{"repo_name":"rails","file_path":"./repos/rails/activemodel/test/cases/validations/exclusion_validation_test.rb","start_line":42,"raw_source":"def test_validates_exclusion_of_for_ruby_class\n    Person.validates_exclusion_of :karma, in: %w( abe monkey )\n\n    p = Person.new\n    p.karma = \"abe\"\n    assert_predicate p, :invalid?\n\n    assert_equal [\"is reserved\"], p.errors[:karma]\n\n    p.karma = \"Lifo\"\n    assert_predicate p, :valid?\n  ensure\n    Person.clear_validators!\n  end","complexity_score":12.6,"ast_json":"{\"type\":\"def\",\"children\":[\"test_validates_exclusion_of_for_ruby_class\",{\"type\":\"args\",\"children\":[]},{\"type\":\"ensure\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Person\"]},\"validates_exclusion_of\",{\"type\":\"sym\",\"children\":[\"karma\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"in\"]},{\"type\":\"array\",\"children\":[{\"type\":\"str\",\"children\":[\"abe\"]},{\"type\":\"str\",\"children\":[\"monkey\"]}]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"p\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Person\"]},\"new\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"p\"]},\"karma=\",{\"type\":\"str\",\"children\":[\"abe\"]}]},{\"type\":\"send\",\"children\":[null,\"assert_predicate\",{\"type\":\"lvar\",\"children\":[\"p\"]},{\"type\":\"sym\",\"children\":[\"invalid?\"]}]},{\"type\":\"send\",\"children\":[null,\"assert_equal\",{\"type\":\"array\",\"children\":[{\"type\":\"str\",\"children\":[\"is reserved\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"p\"]},\"errors\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"karma\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"p\"]},\"karma=\",{\"type\":\"str\",\"children\":[\"Lifo\"]}]},{\"type\":\"send\",\"children\":[null,\"assert_predicate\",{\"type\":\"lvar\",\"children\":[\"p\"]},{\"type\":\"sym\",\"children\":[\"valid?\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Person\"]},\"clear_validators!\"]}]}]}","id":"f27a135c-a293-4200-850c-7d1a4afe2e11"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/keeps/quarantine_flaky_tests.rb","start_line":56,"raw_source":"def groups_helper\n      @groups_helper ||= ::Keeps::Helpers::Groups.new\n    end","complexity_score":2.0,"ast_json":"{\"type\":\"def\",\"children\":[\"groups_helper\",{\"type\":\"args\",\"children\":[]},{\"type\":\"or_asgn\",\"children\":[{\"type\":\"ivasgn\",\"children\":[\"@groups_helper\"]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"cbase\",\"children\":[]},\"Keeps\"]},\"Helpers\"]},\"Groups\"]},\"new\"]}]}]}","id":"407549a5-4a78-4f6c-984e-1ca84f031bde"}
{"repo_name":"discourse","file_path":"./repos/discourse/app/controllers/highlight_js_controller.rb","start_line":13,"raw_source":"def show\n    no_cookies\n\n    RailsMultisite::ConnectionManagement.with_hostname(params[:hostname]) do\n      current_version = HighlightJs.version(SiteSetting.highlighted_languages)\n\n      return redirect_to path(HighlightJs.path) if current_version != params[:version]\n\n      # note, this can be slightly optimised by caching the bundled file, it cuts down on N reads\n      # our nginx config caches this so in practical terms it does not really matter and keeps\n      # code simpler\n      languages = SiteSetting.highlighted_languages.split(\"|\")\n\n      highlight_js = HighlightJs.bundle(languages)\n\n      response.headers[\"Last-Modified\"] = 10.years.ago.httpdate\n      response.headers[\"Content-Length\"] = highlight_js.bytesize.to_s\n      immutable_for 1.year\n\n      render plain: highlight_js, disposition: nil, content_type: \"application/javascript\"\n    end\n  end","complexity_score":44.55,"ast_json":"{\"type\":\"def\",\"children\":[\"show\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"no_cookies\"]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"RailsMultisite\"]},\"ConnectionManagement\"]},\"with_hostname\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"params\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"hostname\"]}]}]},{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"current_version\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"HighlightJs\"]},\"version\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"SiteSetting\"]},\"highlighted_languages\"]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"current_version\"]},\"!=\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"params\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"version\"]}]}]},{\"type\":\"return\",\"children\":[{\"type\":\"send\",\"children\":[null,\"redirect_to\",{\"type\":\"send\",\"children\":[null,\"path\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"HighlightJs\"]},\"path\"]}]}]}]},null]},{\"type\":\"lvasgn\",\"children\":[\"languages\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"SiteSetting\"]},\"highlighted_languages\"]},\"split\",{\"type\":\"str\",\"children\":[\"|\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"highlight_js\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"HighlightJs\"]},\"bundle\",{\"type\":\"lvar\",\"children\":[\"languages\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"response\"]},\"headers\"]},\"[]=\",{\"type\":\"str\",\"children\":[\"Last-Modified\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"int\",\"children\":[10]},\"years\"]},\"ago\"]},\"httpdate\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"response\"]},\"headers\"]},\"[]=\",{\"type\":\"str\",\"children\":[\"Content-Length\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"highlight_js\"]},\"bytesize\"]},\"to_s\"]}]},{\"type\":\"send\",\"children\":[null,\"immutable_for\",{\"type\":\"send\",\"children\":[{\"type\":\"int\",\"children\":[1]},\"year\"]}]},{\"type\":\"send\",\"children\":[null,\"render\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"plain\"]},{\"type\":\"lvar\",\"children\":[\"highlight_js\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"disposition\"]},{\"type\":\"nil\",\"children\":[]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"content_type\"]},{\"type\":\"str\",\"children\":[\"application/javascript\"]}]}]}]}]}]}]}]}","id":"de100a04-ac6f-495f-a037-14d39bbfa05a"}
{"repo_name":"rails","file_path":"./repos/rails/activerecord/test/cases/finder_test.rb","start_line":1256,"raw_source":"def test_implicit_order_set_to_primary_key\n    old_implicit_order_column = Topic.implicit_order_column\n    Topic.implicit_order_column = \"id\"\n\n    assert_queries_match(/ORDER BY #{Regexp.escape(quote_table_name(\"topics.id\"))} DESC LIMIT/i) {\n      Topic.last\n    }\n  ensure\n    Topic.implicit_order_column = old_implicit_order_column\n  end","complexity_score":10.5,"ast_json":"{\"type\":\"def\",\"children\":[\"test_implicit_order_set_to_primary_key\",{\"type\":\"args\",\"children\":[]},{\"type\":\"ensure\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"old_implicit_order_column\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Topic\"]},\"implicit_order_column\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Topic\"]},\"implicit_order_column=\",{\"type\":\"str\",\"children\":[\"id\"]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"assert_queries_match\",{\"type\":\"regexp\",\"children\":[{\"type\":\"str\",\"children\":[\"ORDER BY \"]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Regexp\"]},\"escape\",{\"type\":\"send\",\"children\":[null,\"quote_table_name\",{\"type\":\"str\",\"children\":[\"topics.id\"]}]}]}]},{\"type\":\"str\",\"children\":[\" DESC LIMIT\"]},{\"type\":\"regopt\",\"children\":[\"i\"]}]}]},{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Topic\"]},\"last\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Topic\"]},\"implicit_order_column=\",{\"type\":\"lvar\",\"children\":[\"old_implicit_order_column\"]}]}]}]}","id":"55522f21-9fd8-4ab4-908e-35f5c833f2f5"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/lib/gitlab/bullet/exclusions.rb","start_line":10,"raw_source":"def execute\n        exclusions.map { |v| v['exclude'] }\n      end","complexity_score":4.3,"ast_json":"{\"type\":\"def\",\"children\":[\"execute\",{\"type\":\"args\",\"children\":[]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"exclusions\"]},\"map\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"v\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"v\"]},\"[]\",{\"type\":\"str\",\"children\":[\"exclude\"]}]}]}]}","id":"7850cf01-bfa8-45f9-acf2-44ba06830974"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/models/ci/unit_test_failure.rb","start_line":22,"raw_source":"def self.recent_failures_count(project:, unit_test_keys:, date_range: REPORT_WINDOW.ago..Time.current)\n      joins(:unit_test)\n        .where(\n          ci_unit_tests: {\n            project_id: project.id,\n            key_hash: unit_test_keys\n          },\n          ci_unit_test_failures: {\n            failed_at: date_range\n          }\n        )\n        .group(:key_hash)\n        .count('ci_unit_test_failures.id')\n    end","complexity_score":8.8,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"recent_failures_count\",{\"type\":\"args\",\"children\":[{\"type\":\"kwarg\",\"children\":[\"project\"]},{\"type\":\"kwarg\",\"children\":[\"unit_test_keys\"]},{\"type\":\"kwoptarg\",\"children\":[\"date_range\",{\"type\":\"irange\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"REPORT_WINDOW\"]},\"ago\"]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Time\"]},\"current\"]}]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"joins\",{\"type\":\"sym\",\"children\":[\"unit_test\"]}]},\"where\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"ci_unit_tests\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"project_id\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"project\"]},\"id\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"key_hash\"]},{\"type\":\"lvar\",\"children\":[\"unit_test_keys\"]}]}]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"ci_unit_test_failures\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"failed_at\"]},{\"type\":\"lvar\",\"children\":[\"date_range\"]}]}]}]}]}]},\"group\",{\"type\":\"sym\",\"children\":[\"key_hash\"]}]},\"count\",{\"type\":\"str\",\"children\":[\"ci_unit_test_failures.id\"]}]}]}","id":"d83605b8-46a7-4e36-b903-506f6d92e931"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/serializers/deploy_keys/basic_deploy_key_entity.rb","start_line":33,"raw_source":"def can_edit\n      Ability.allowed?(options[:user], :update_deploy_key, object) ||\n        Ability.allowed?(options[:user], :update_deploy_keys_project, object.deploy_keys_project_for(options[:project]))\n    end","complexity_score":16.1,"ast_json":"{\"type\":\"def\",\"children\":[\"can_edit\",{\"type\":\"args\",\"children\":[]},{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Ability\"]},\"allowed?\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"options\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"user\"]}]},{\"type\":\"sym\",\"children\":[\"update_deploy_key\"]},{\"type\":\"send\",\"children\":[null,\"object\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Ability\"]},\"allowed?\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"options\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"user\"]}]},{\"type\":\"sym\",\"children\":[\"update_deploy_keys_project\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"object\"]},\"deploy_keys_project_for\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"options\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"project\"]}]}]}]}]}]}","id":"f95c977f-c742-49fd-8c9e-49f106168799"}
{"repo_name":"hooks","file_path":"./repos/hooks/lib/hooks/plugins/auth/shared_secret.rb","start_line":108,"raw_source":"def self.build_config(config)\n          validator_config = config.dig(:auth) || {}\n\n          DEFAULT_CONFIG.merge({\n            header: validator_config[:header] || DEFAULT_CONFIG[:header]\n          })\n        end","complexity_score":7.9,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"build_config\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"config\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"validator_config\",{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"config\"]},\"dig\",{\"type\":\"sym\",\"children\":[\"auth\"]}]},{\"type\":\"hash\",\"children\":[]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"DEFAULT_CONFIG\"]},\"merge\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"header\"]},{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"validator_config\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"header\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"DEFAULT_CONFIG\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"header\"]}]}]}]}]}]}]}]}","id":"05bb30e5-d82e-4516-8c12-962c91116753"}
{"repo_name":"discourse","file_path":"./repos/discourse/spec/support/webauthn_integration_helpers.rb","start_line":82,"raw_source":"def valid_passkey_auth_data\n    {\n      clientData: Base64.strict_encode64(passkey_client_data_param(\"webauthn.get\").to_json),\n      credentialId: \"JFeriwVn1elZk7N8nwSC4magQ8zM1XIUxRZB9Pm7VDM=\",\n      authenticatorData: \"SZYN5YgOjGh0NBcPZHZgW4/krrmihjLHmVzzuoMdl2MFAAAAAA==\",\n      signature:\n        \"MEUCIG5AFaw2Nfy69hHjeRLqm3LzQRMFb+TRbUAz19WJymegAiEAyEEyGdAMB2/NBwRCHM47IwtjKWCLEtabAX2BaK6fD8g=\",\n    }\n  end","complexity_score":3.6,"ast_json":"{\"type\":\"def\",\"children\":[\"valid_passkey_auth_data\",{\"type\":\"args\",\"children\":[]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"clientData\"]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Base64\"]},\"strict_encode64\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"passkey_client_data_param\",{\"type\":\"str\",\"children\":[\"webauthn.get\"]}]},\"to_json\"]}]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"credentialId\"]},{\"type\":\"str\",\"children\":[\"JFeriwVn1elZk7N8nwSC4magQ8zM1XIUxRZB9Pm7VDM=\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"authenticatorData\"]},{\"type\":\"str\",\"children\":[\"SZYN5YgOjGh0NBcPZHZgW4/krrmihjLHmVzzuoMdl2MFAAAAAA==\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"signature\"]},{\"type\":\"str\",\"children\":[\"MEUCIG5AFaw2Nfy69hHjeRLqm3LzQRMFb+TRbUAz19WJymegAiEAyEEyGdAMB2/NBwRCHM47IwtjKWCLEtabAX2BaK6fD8g=\"]}]}]}]}","id":"99ea9aaf-319c-4a84-a60a-60d91500817d"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/qa/qa/page/project/web_ide/vscode.rb","start_line":240,"raw_source":"def push_to_new_branch\n            within_vscode_editor do\n              click_new_branch\n              has_branch_input_field?\n              # Typing enter to 'New branch name' popup to take the default branch name\n              send_keys(:enter)\n            end\n\n            return if commit_shows_message?(COMMIT_SUCCESS_MESSAGE)\n\n            raise \"failed to push_to_new_branch\"\n          end","complexity_score":8.6,"ast_json":"{\"type\":\"def\",\"children\":[\"push_to_new_branch\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"within_vscode_editor\"]},{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"click_new_branch\"]},{\"type\":\"send\",\"children\":[null,\"has_branch_input_field?\"]},{\"type\":\"send\",\"children\":[null,\"send_keys\",{\"type\":\"sym\",\"children\":[\"enter\"]}]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"commit_shows_message?\",{\"type\":\"const\",\"children\":[null,\"COMMIT_SUCCESS_MESSAGE\"]}]},{\"type\":\"return\",\"children\":[]},null]},{\"type\":\"send\",\"children\":[null,\"raise\",{\"type\":\"str\",\"children\":[\"failed to push_to_new_branch\"]}]}]}]}","id":"fe5b8b1d-299a-4051-9119-eba1a83fccf1"}
{"repo_name":"discourse","file_path":"./repos/discourse/app/models/color_scheme.rb","start_line":282,"raw_source":"def self.base_color_scheme_colors\n    base_with_hash = []\n\n    base_colors.each { |name, color| base_with_hash << { name: name, hex: \"#{color}\" } }\n\n    list = [{ id: LIGHT_THEME_ID, colors: base_with_hash }]\n\n    BUILT_IN_SCHEMES.each do |k, v|\n      colors = []\n      v.each { |name, color| colors << { name: name, hex: \"#{color}\" } }\n      list.push(id: k.to_s, colors: colors)\n    end\n\n    list\n  end","complexity_score":15.8,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"base_color_scheme_colors\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"base_with_hash\",{\"type\":\"array\",\"children\":[]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"base_colors\"]},\"each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"name\"]},{\"type\":\"arg\",\"children\":[\"color\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"base_with_hash\"]},\"<<\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"name\"]},{\"type\":\"lvar\",\"children\":[\"name\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"hex\"]},{\"type\":\"dstr\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"color\"]}]}]}]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"list\",{\"type\":\"array\",\"children\":[{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"id\"]},{\"type\":\"const\",\"children\":[null,\"LIGHT_THEME_ID\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"colors\"]},{\"type\":\"lvar\",\"children\":[\"base_with_hash\"]}]}]}]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"BUILT_IN_SCHEMES\"]},\"each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"k\"]},{\"type\":\"arg\",\"children\":[\"v\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"colors\",{\"type\":\"array\",\"children\":[]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"v\"]},\"each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"name\"]},{\"type\":\"arg\",\"children\":[\"color\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"colors\"]},\"<<\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"name\"]},{\"type\":\"lvar\",\"children\":[\"name\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"hex\"]},{\"type\":\"dstr\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"color\"]}]}]}]}]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"list\"]},\"push\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"id\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"k\"]},\"to_s\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"colors\"]},{\"type\":\"lvar\",\"children\":[\"colors\"]}]}]}]}]}]},{\"type\":\"lvar\",\"children\":[\"list\"]}]}]}","id":"10f682c8-9ce4-4144-aa98-5bd1ded3f486"}
{"repo_name":"fastlane","file_path":"./repos/fastlane/deliver/spec/sync_screenshots_spec.rb","start_line":187,"raw_source":"def mock_app_screenshot(path: '/path/to/screenshot')\n      screenshot = double(\n        'Spaceship::ConnectAPI::AppScreenshot',\n        file_name: path,\n        source_file_checksum: path # To match the behavior of stubbing checksum calculation, use given path as a checksum\n      )\n      allow(screenshot).to receive(:kind_of?).with(Spaceship::ConnectAPI::AppScreenshot).and_return(true)\n      screenshot\n    end","complexity_score":8.4,"ast_json":"{\"type\":\"def\",\"children\":[\"mock_app_screenshot\",{\"type\":\"args\",\"children\":[{\"type\":\"kwoptarg\",\"children\":[\"path\",{\"type\":\"str\",\"children\":[\"/path/to/screenshot\"]}]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"screenshot\",{\"type\":\"send\",\"children\":[null,\"double\",{\"type\":\"str\",\"children\":[\"Spaceship::ConnectAPI::AppScreenshot\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"file_name\"]},{\"type\":\"lvar\",\"children\":[\"path\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"source_file_checksum\"]},{\"type\":\"lvar\",\"children\":[\"path\"]}]}]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"allow\",{\"type\":\"lvar\",\"children\":[\"screenshot\"]}]},\"to\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"receive\",{\"type\":\"sym\",\"children\":[\"kind_of?\"]}]},\"with\",{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Spaceship\"]},\"ConnectAPI\"]},\"AppScreenshot\"]}]},\"and_return\",{\"type\":\"true\",\"children\":[]}]}]},{\"type\":\"lvar\",\"children\":[\"screenshot\"]}]}]}","id":"b8e02977-6fbb-4f43-9130-d151e0c5cf9d"}
{"repo_name":"rails","file_path":"./repos/rails/activerecord/test/cases/finder_test.rb","start_line":1507,"raw_source":"def test_hash_condition_find_with_aggregate_attribute_having_same_name_as_field_and_key_value_being_attribute_value\n    gps_location = customers(:david).gps_location\n    assert_kind_of GpsLocation, gps_location\n    found_customer = Customer.where(gps_location: gps_location.gps_location).first\n    assert_equal customers(:david), found_customer\n  end","complexity_score":11.0,"ast_json":"{\"type\":\"def\",\"children\":[\"test_hash_condition_find_with_aggregate_attribute_having_same_name_as_field_and_key_value_being_attribute_value\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"gps_location\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"customers\",{\"type\":\"sym\",\"children\":[\"david\"]}]},\"gps_location\"]}]},{\"type\":\"send\",\"children\":[null,\"assert_kind_of\",{\"type\":\"const\",\"children\":[null,\"GpsLocation\"]},{\"type\":\"lvar\",\"children\":[\"gps_location\"]}]},{\"type\":\"lvasgn\",\"children\":[\"found_customer\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Customer\"]},\"where\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"gps_location\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"gps_location\"]},\"gps_location\"]}]}]}]},\"first\"]}]},{\"type\":\"send\",\"children\":[null,\"assert_equal\",{\"type\":\"send\",\"children\":[null,\"customers\",{\"type\":\"sym\",\"children\":[\"david\"]}]},{\"type\":\"lvar\",\"children\":[\"found_customer\"]}]}]}]}","id":"5cd9d705-84b7-4fce-958b-5e8aa7aee8d1"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/lib/gitlab/instrumentation/connection_pool.rb","start_line":7,"raw_source":"def initialize(options = {}, &block)\n        @name = options.fetch(:name, 'unknown')\n\n        super\n      end","complexity_score":3.0,"ast_json":"{\"type\":\"def\",\"children\":[\"initialize\",{\"type\":\"args\",\"children\":[{\"type\":\"optarg\",\"children\":[\"options\",{\"type\":\"hash\",\"children\":[]}]},{\"type\":\"blockarg\",\"children\":[\"block\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"ivasgn\",\"children\":[\"@name\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"options\"]},\"fetch\",{\"type\":\"sym\",\"children\":[\"name\"]},{\"type\":\"str\",\"children\":[\"unknown\"]}]}]},{\"type\":\"zsuper\",\"children\":[]}]}]}","id":"9d25fc23-8768-44f1-b342-bc01b38f4821"}
{"repo_name":"rails","file_path":"./repos/rails/activerecord/test/cases/relation_test.rb","start_line":159,"raw_source":"def test_references_values\n      relation = Relation.new(FakeKlass)\n      assert_equal [], relation.references_values\n      relation = relation.references(:foo).references(:omg, :lol)\n      assert_equal [:foo, :omg, :lol], relation.references_values\n    end","complexity_score":9.6,"ast_json":"{\"type\":\"def\",\"children\":[\"test_references_values\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"relation\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Relation\"]},\"new\",{\"type\":\"const\",\"children\":[null,\"FakeKlass\"]}]}]},{\"type\":\"send\",\"children\":[null,\"assert_equal\",{\"type\":\"array\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"relation\"]},\"references_values\"]}]},{\"type\":\"lvasgn\",\"children\":[\"relation\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"relation\"]},\"references\",{\"type\":\"sym\",\"children\":[\"foo\"]}]},\"references\",{\"type\":\"sym\",\"children\":[\"omg\"]},{\"type\":\"sym\",\"children\":[\"lol\"]}]}]},{\"type\":\"send\",\"children\":[null,\"assert_equal\",{\"type\":\"array\",\"children\":[{\"type\":\"sym\",\"children\":[\"foo\"]},{\"type\":\"sym\",\"children\":[\"omg\"]},{\"type\":\"sym\",\"children\":[\"lol\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"relation\"]},\"references_values\"]}]}]}]}","id":"ffecdf35-766b-424d-901a-b99c9419b3aa"}
