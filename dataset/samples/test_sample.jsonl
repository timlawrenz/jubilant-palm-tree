{"repo_name":"rails","file_path":"./repos/rails/activesupport/test/hash_with_indifferent_access_test.rb","start_line":106,"raw_source":"def test_stringify_keys_stringifies_non_string_keys_for_hash_with_indifferent_access\n    object = Object.new\n    hash = { object => 1 }\n    assert_equal({ object.to_s => 1 }, hash.with_indifferent_access.stringify_keys)\n  end","complexity_score":8.35,"ast_json":"{\"type\":\"def\",\"children\":[\"test_stringify_keys_stringifies_non_string_keys_for_hash_with_indifferent_access\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"object\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Object\"]},\"new\"]}]},{\"type\":\"lvasgn\",\"children\":[\"hash\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"lvar\",\"children\":[\"object\"]},{\"type\":\"int\",\"children\":[1]}]}]}]},{\"type\":\"send\",\"children\":[null,\"assert_equal\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"object\"]},\"to_s\"]},{\"type\":\"int\",\"children\":[1]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"hash\"]},\"with_indifferent_access\"]},\"stringify_keys\"]}]}]}]}","id":"fa0bf670-a3f1-4b80-a92e-54cd25cbfc52"}
{"repo_name":"discourse","file_path":"./repos/discourse/app/models/directory_item.rb","start_line":13,"raw_source":"def self.refresh!\n    period_types.each_key { |p| refresh_period!(p) }\n  end","complexity_score":4.3,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"refresh!\",{\"type\":\"args\",\"children\":[]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"period_types\"]},\"each_key\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"p\"]}]},{\"type\":\"send\",\"children\":[null,\"refresh_period!\",{\"type\":\"lvar\",\"children\":[\"p\"]}]}]}]}","id":"cf92b03a-650f-4869-b592-60009bd5e92a"}
{"repo_name":"rails","file_path":"./repos/rails/actionview/test/template/form_tag_helper_test.rb","start_line":306,"raw_source":"def test_field_name_with_method_names_and_index\n    value = field_name(:post, :title, :subtitle, index: 1)\n\n    assert_equal \"post[1][title][subtitle]\", value\n  end","complexity_score":3.3,"ast_json":"{\"type\":\"def\",\"children\":[\"test_field_name_with_method_names_and_index\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"value\",{\"type\":\"send\",\"children\":[null,\"field_name\",{\"type\":\"sym\",\"children\":[\"post\"]},{\"type\":\"sym\",\"children\":[\"title\"]},{\"type\":\"sym\",\"children\":[\"subtitle\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"index\"]},{\"type\":\"int\",\"children\":[1]}]}]}]}]},{\"type\":\"send\",\"children\":[null,\"assert_equal\",{\"type\":\"str\",\"children\":[\"post[1][title][subtitle]\"]},{\"type\":\"lvar\",\"children\":[\"value\"]}]}]}]}","id":"3e303b94-888a-4bb2-90d9-fa6ef12fdfea"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/services/merge_requests/push_options_handler_service.rb","start_line":178,"raw_source":"def merge_params(branch)\n      return {} unless push_options.key?(:merge_when_pipeline_succeeds) || push_options.key?(:auto_merge)\n\n      {\n        auto_merge_enabled: push_options[:auto_merge] || push_options[:merge_when_pipeline_succeeds],\n        merge_user: current_user,\n        sha: changes_by_branch.dig(branch, :newrev)\n      }\n    end","complexity_score":15.8,"ast_json":"{\"type\":\"def\",\"children\":[\"merge_params\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"branch\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"push_options\"]},\"key?\",{\"type\":\"sym\",\"children\":[\"merge_when_pipeline_succeeds\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"push_options\"]},\"key?\",{\"type\":\"sym\",\"children\":[\"auto_merge\"]}]}]},null,{\"type\":\"return\",\"children\":[{\"type\":\"hash\",\"children\":[]}]}]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"auto_merge_enabled\"]},{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"push_options\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"auto_merge\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"push_options\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"merge_when_pipeline_succeeds\"]}]}]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"merge_user\"]},{\"type\":\"send\",\"children\":[null,\"current_user\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"sha\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"changes_by_branch\"]},\"dig\",{\"type\":\"lvar\",\"children\":[\"branch\"]},{\"type\":\"sym\",\"children\":[\"newrev\"]}]}]}]}]}]}","id":"878fcd2e-c13c-4f8b-b9c3-c6e19d805322"}
{"repo_name":"rails","file_path":"./repos/rails/railties/test/minitest/rails_plugin_test.rb","start_line":79,"raw_source":"def baseline_reporters\n      [Minitest::SummaryReporter.new(@output), Minitest::ProgressReporter.new(@output)]\n    end","complexity_score":2.0,"ast_json":"{\"type\":\"def\",\"children\":[\"baseline_reporters\",{\"type\":\"args\",\"children\":[]},{\"type\":\"array\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Minitest\"]},\"SummaryReporter\"]},\"new\",{\"type\":\"ivar\",\"children\":[\"@output\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Minitest\"]},\"ProgressReporter\"]},\"new\",{\"type\":\"ivar\",\"children\":[\"@output\"]}]}]}]}","id":"80f9ce72-e7fd-4941-9412-f6cbceb12848"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/finders/cluster_ancestors_finder.rb","start_line":17,"raw_source":"def has_ancestor_clusters?\n    ancestor_clusters.any?\n  end","complexity_score":2.2,"ast_json":"{\"type\":\"def\",\"children\":[\"has_ancestor_clusters?\",{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"ancestor_clusters\"]},\"any?\"]}]}","id":"167c8167-4e46-47b3-ab90-6202dff486f2"}
{"repo_name":"rubocop","file_path":"./repos/rubocop/lib/rubocop/cop/lint/heredoc_method_call_position.rb","start_line":50,"raw_source":"def autocorrect(corrector, node, heredoc)\n          call_range = call_range_to_safely_reposition(node, heredoc)\n          return if call_range.nil?\n\n          call_source = call_range.source.strip\n          corrector.remove(call_range)\n          corrector.insert_after(heredoc_begin_line_range(node), call_source)\n        end","complexity_score":10.4,"ast_json":"{\"type\":\"def\",\"children\":[\"autocorrect\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"corrector\"]},{\"type\":\"arg\",\"children\":[\"node\"]},{\"type\":\"arg\",\"children\":[\"heredoc\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"call_range\",{\"type\":\"send\",\"children\":[null,\"call_range_to_safely_reposition\",{\"type\":\"lvar\",\"children\":[\"node\"]},{\"type\":\"lvar\",\"children\":[\"heredoc\"]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"call_range\"]},\"nil?\"]},{\"type\":\"return\",\"children\":[]},null]},{\"type\":\"lvasgn\",\"children\":[\"call_source\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"call_range\"]},\"source\"]},\"strip\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"corrector\"]},\"remove\",{\"type\":\"lvar\",\"children\":[\"call_range\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"corrector\"]},\"insert_after\",{\"type\":\"send\",\"children\":[null,\"heredoc_begin_line_range\",{\"type\":\"lvar\",\"children\":[\"node\"]}]},{\"type\":\"lvar\",\"children\":[\"call_source\"]}]}]}]}","id":"106cc2a4-8b96-4cea-aa33-1b3add7605b9"}
{"repo_name":"rubocop","file_path":"./repos/rubocop/lib/rubocop/cop/lint/redundant_regexp_quantifiers.rb","start_line":119,"raw_source":"def message(group, child, replacement)\n          format(\n            MSG_REDUNDANT_QUANTIFIER,\n            inner_quantifier: child.quantifier.to_s,\n            outer_quantifier: group.quantifier.to_s,\n            replacement: replacement\n          )\n        end","complexity_score":6.2,"ast_json":"{\"type\":\"def\",\"children\":[\"message\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"group\"]},{\"type\":\"arg\",\"children\":[\"child\"]},{\"type\":\"arg\",\"children\":[\"replacement\"]}]},{\"type\":\"send\",\"children\":[null,\"format\",{\"type\":\"const\",\"children\":[null,\"MSG_REDUNDANT_QUANTIFIER\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"inner_quantifier\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"child\"]},\"quantifier\"]},\"to_s\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"outer_quantifier\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"group\"]},\"quantifier\"]},\"to_s\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"replacement\"]},{\"type\":\"lvar\",\"children\":[\"replacement\"]}]}]}]}]}","id":"2cdf64c3-f856-4da1-b0e2-cec8783a818c"}
{"repo_name":"manageiq","file_path":"./repos/manageiq/app/models/miq_worker.rb","start_line":214,"raw_source":"def self.fetch_worker_settings_from_options_hash(options_hash, raw = false)\n    return {} unless options_hash.key?(:workers)\n\n    settings = {}\n    # Get the configuration values\n    section = options_hash[:workers]\n    unless section.nil?\n      classes = path_to_my_worker_settings\n      classes.each do |c|\n        section = section[c]\n        raise _(\"Missing config section %{section_name}\") % {:section_name => c} if section.nil?\n\n        defaults = section[:defaults]\n        unless defaults.nil?\n          defaults.delete_if { |_k, v| v == Vmdb::Settings::RESET_VALUE }\n          settings.merge!(defaults)\n        end\n      end\n\n      section.delete_if { |_k, v| v == Vmdb::Settings::RESET_VALUE }\n      settings.merge!(section)\n      normalize_settings!(settings) unless raw == true\n    end\n\n    settings\n  end","complexity_score":44.2,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"fetch_worker_settings_from_options_hash\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"options_hash\"]},{\"type\":\"optarg\",\"children\":[\"raw\",{\"type\":\"false\",\"children\":[]}]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"options_hash\"]},\"key?\",{\"type\":\"sym\",\"children\":[\"workers\"]}]},null,{\"type\":\"return\",\"children\":[{\"type\":\"hash\",\"children\":[]}]}]},{\"type\":\"lvasgn\",\"children\":[\"settings\",{\"type\":\"hash\",\"children\":[]}]},{\"type\":\"lvasgn\",\"children\":[\"section\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"options_hash\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"workers\"]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"section\"]},\"nil?\"]},null,{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"classes\",{\"type\":\"send\",\"children\":[null,\"path_to_my_worker_settings\"]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"classes\"]},\"each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"c\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"section\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"section\"]},\"[]\",{\"type\":\"lvar\",\"children\":[\"c\"]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"section\"]},\"nil?\"]},{\"type\":\"send\",\"children\":[null,\"raise\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"_\",{\"type\":\"str\",\"children\":[\"Missing config section %{section_name}\"]}]},\"%\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"section_name\"]},{\"type\":\"lvar\",\"children\":[\"c\"]}]}]}]}]},null]},{\"type\":\"lvasgn\",\"children\":[\"defaults\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"section\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"defaults\"]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"defaults\"]},\"nil?\"]},null,{\"type\":\"begin\",\"children\":[{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"defaults\"]},\"delete_if\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"_k\"]},{\"type\":\"arg\",\"children\":[\"v\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"v\"]},\"==\",{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Vmdb\"]},\"Settings\"]},\"RESET_VALUE\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"settings\"]},\"merge!\",{\"type\":\"lvar\",\"children\":[\"defaults\"]}]}]}]}]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"section\"]},\"delete_if\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"_k\"]},{\"type\":\"arg\",\"children\":[\"v\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"v\"]},\"==\",{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Vmdb\"]},\"Settings\"]},\"RESET_VALUE\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"settings\"]},\"merge!\",{\"type\":\"lvar\",\"children\":[\"section\"]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"raw\"]},\"==\",{\"type\":\"true\",\"children\":[]}]},null,{\"type\":\"send\",\"children\":[null,\"normalize_settings!\",{\"type\":\"lvar\",\"children\":[\"settings\"]}]}]}]}]},{\"type\":\"lvar\",\"children\":[\"settings\"]}]}]}","id":"edcb7853-2004-44ec-a814-002b88b1d5b8"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/models/blob.rb","start_line":140,"raw_source":"def external_storage_error?\n    if external_storage == :lfs\n      !repository.lfs_enabled?\n    else\n      false\n    end\n  end","complexity_score":7.1,"ast_json":"{\"type\":\"def\",\"children\":[\"external_storage_error?\",{\"type\":\"args\",\"children\":[]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"external_storage\"]},\"==\",{\"type\":\"sym\",\"children\":[\"lfs\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"repository\"]},\"lfs_enabled?\"]},\"!\"]},{\"type\":\"false\",\"children\":[]}]}]}","id":"b003a70b-8661-40b3-93c5-237d17817caf"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/lib/gitlab/database/migration_helpers.rb","start_line":640,"raw_source":"def undo_cleanup_concurrent_column_type_change(table, column, old_type, type_cast_function: nil, batch_column_name: :id, limit: nil, temp_column: nil)\n        Gitlab::Database::QueryAnalyzers::RestrictAllowedSchemas.require_ddl_mode!\n\n        temp_column ||= \"#{column}_for_type_change\"\n\n        # Using a descriptive name that includes orinal column's name risks\n        # taking us above the 63 character limit, so we use a hash\n        identifier = \"#{table}_#{column}_for_type_change\"\n        hashed_identifier = Digest::SHA256.hexdigest(identifier).first(10)\n        temp_undo_cleanup_column = \"tmp_undo_cleanup_column_#{hashed_identifier}\"\n\n        unless column_exists?(table, batch_column_name)\n          raise \"Column #{batch_column_name} does not exist on #{table}\"\n        end\n\n        if transaction_open?\n          raise 'undo_cleanup_concurrent_column_type_change can not be run inside a transaction'\n        end\n\n        check_trigger_permissions!(table)\n\n        begin\n          create_column_from(\n            table,\n            column,\n            temp_undo_cleanup_column,\n            type: old_type,\n            batch_column_name: batch_column_name,\n            type_cast_function: type_cast_function,\n            limit: limit\n          )\n\n          transaction do\n            # This has to be performed in a transaction as otherwise we might\n            # have inconsistent data.\n            rename_column(table, column, temp_column)\n            rename_column(table, temp_undo_cleanup_column, column)\n\n            install_rename_triggers(table, column, temp_column)\n          end\n        rescue StandardError\n          # create_column_from can not run inside a transaction, which means\n          #  that there is a risk that if any of the operations that follow it\n          #  fail, we'll be left with an inconsistent schema\n          # For those reasons, we make sure that we drop temp_undo_cleanup_column\n          #  if an error is caught\n          if column_exists?(table, temp_undo_cleanup_column)\n            remove_column(table, temp_undo_cleanup_column)\n          end\n\n          raise\n        end\n      end","complexity_score":28.0,"ast_json":"{\"type\":\"def\",\"children\":[\"undo_cleanup_concurrent_column_type_change\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"table\"]},{\"type\":\"arg\",\"children\":[\"column\"]},{\"type\":\"arg\",\"children\":[\"old_type\"]},{\"type\":\"kwoptarg\",\"children\":[\"type_cast_function\",{\"type\":\"nil\",\"children\":[]}]},{\"type\":\"kwoptarg\",\"children\":[\"batch_column_name\",{\"type\":\"sym\",\"children\":[\"id\"]}]},{\"type\":\"kwoptarg\",\"children\":[\"limit\",{\"type\":\"nil\",\"children\":[]}]},{\"type\":\"kwoptarg\",\"children\":[\"temp_column\",{\"type\":\"nil\",\"children\":[]}]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Gitlab\"]},\"Database\"]},\"QueryAnalyzers\"]},\"RestrictAllowedSchemas\"]},\"require_ddl_mode!\"]},{\"type\":\"or_asgn\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"temp_column\"]},{\"type\":\"dstr\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"column\"]}]},{\"type\":\"str\",\"children\":[\"_for_type_change\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"identifier\",{\"type\":\"dstr\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"table\"]}]},{\"type\":\"str\",\"children\":[\"_\"]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"column\"]}]},{\"type\":\"str\",\"children\":[\"_for_type_change\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"hashed_identifier\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Digest\"]},\"SHA256\"]},\"hexdigest\",{\"type\":\"lvar\",\"children\":[\"identifier\"]}]},\"first\",{\"type\":\"int\",\"children\":[10]}]}]},{\"type\":\"lvasgn\",\"children\":[\"temp_undo_cleanup_column\",{\"type\":\"dstr\",\"children\":[{\"type\":\"str\",\"children\":[\"tmp_undo_cleanup_column_\"]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"hashed_identifier\"]}]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"column_exists?\",{\"type\":\"lvar\",\"children\":[\"table\"]},{\"type\":\"lvar\",\"children\":[\"batch_column_name\"]}]},null,{\"type\":\"send\",\"children\":[null,\"raise\",{\"type\":\"dstr\",\"children\":[{\"type\":\"str\",\"children\":[\"Column \"]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"batch_column_name\"]}]},{\"type\":\"str\",\"children\":[\" does not exist on \"]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"table\"]}]}]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"transaction_open?\"]},{\"type\":\"send\",\"children\":[null,\"raise\",{\"type\":\"str\",\"children\":[\"undo_cleanup_concurrent_column_type_change can not be run inside a transaction\"]}]},null]},{\"type\":\"send\",\"children\":[null,\"check_trigger_permissions!\",{\"type\":\"lvar\",\"children\":[\"table\"]}]},{\"type\":\"kwbegin\",\"children\":[{\"type\":\"rescue\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"create_column_from\",{\"type\":\"lvar\",\"children\":[\"table\"]},{\"type\":\"lvar\",\"children\":[\"column\"]},{\"type\":\"lvar\",\"children\":[\"temp_undo_cleanup_column\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"type\"]},{\"type\":\"lvar\",\"children\":[\"old_type\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"batch_column_name\"]},{\"type\":\"lvar\",\"children\":[\"batch_column_name\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"type_cast_function\"]},{\"type\":\"lvar\",\"children\":[\"type_cast_function\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"limit\"]},{\"type\":\"lvar\",\"children\":[\"limit\"]}]}]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"transaction\"]},{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"rename_column\",{\"type\":\"lvar\",\"children\":[\"table\"]},{\"type\":\"lvar\",\"children\":[\"column\"]},{\"type\":\"lvar\",\"children\":[\"temp_column\"]}]},{\"type\":\"send\",\"children\":[null,\"rename_column\",{\"type\":\"lvar\",\"children\":[\"table\"]},{\"type\":\"lvar\",\"children\":[\"temp_undo_cleanup_column\"]},{\"type\":\"lvar\",\"children\":[\"column\"]}]},{\"type\":\"send\",\"children\":[null,\"install_rename_triggers\",{\"type\":\"lvar\",\"children\":[\"table\"]},{\"type\":\"lvar\",\"children\":[\"column\"]},{\"type\":\"lvar\",\"children\":[\"temp_column\"]}]}]}]}]},{\"type\":\"resbody\",\"children\":[{\"type\":\"array\",\"children\":[{\"type\":\"const\",\"children\":[null,\"StandardError\"]}]},null,{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"column_exists?\",{\"type\":\"lvar\",\"children\":[\"table\"]},{\"type\":\"lvar\",\"children\":[\"temp_undo_cleanup_column\"]}]},{\"type\":\"send\",\"children\":[null,\"remove_column\",{\"type\":\"lvar\",\"children\":[\"table\"]},{\"type\":\"lvar\",\"children\":[\"temp_undo_cleanup_column\"]}]},null]},{\"type\":\"send\",\"children\":[null,\"raise\"]}]}]},null]}]}]}]}","id":"0a70a2ee-c26d-40af-85bd-32fe9de6250c"}
{"repo_name":"forem","file_path":"./repos/forem/app/controllers/admin/tools_controller.rb","start_line":25,"raw_source":"def feed_playground\n      return if params[:config].blank?\n\n      begin\n        config_json = JSON.parse(params[:config])\n        config = Articles::Feeds::VariantAssembler\n          .build_with(catalog: Articles::Feeds.lever_catalog, config: config_json, variant: \"test\")\n        @user = User.find_by(username: params[:username]) || current_user\n        @feed = Articles::Feeds::VariantQuery.new(\n          config: config,\n          user: @user,\n          number_of_articles: params[:number_of_articles] || 25,\n          page: 1,\n          tag: nil,\n        )\n        @articles = @feed.more_comments_minimal_weight_randomized.to_a\n      rescue KeyError, JSON::ParserError, ActiveRecord::StatementInvalid => e\n        flash[:danger] = e.message\n      end\n    end","complexity_score":38.93,"ast_json":"{\"type\":\"def\",\"children\":[\"feed_playground\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"params\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"config\"]}]},\"blank?\"]},{\"type\":\"return\",\"children\":[]},null]},{\"type\":\"kwbegin\",\"children\":[{\"type\":\"rescue\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"config_json\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"JSON\"]},\"parse\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"params\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"config\"]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"config\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Articles\"]},\"Feeds\"]},\"VariantAssembler\"]},\"build_with\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"catalog\"]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Articles\"]},\"Feeds\"]},\"lever_catalog\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"config\"]},{\"type\":\"lvar\",\"children\":[\"config_json\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"variant\"]},{\"type\":\"str\",\"children\":[\"test\"]}]}]}]}]},{\"type\":\"ivasgn\",\"children\":[\"@user\",{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"User\"]},\"find_by\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"username\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"params\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"username\"]}]}]}]}]},{\"type\":\"send\",\"children\":[null,\"current_user\"]}]}]},{\"type\":\"ivasgn\",\"children\":[\"@feed\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Articles\"]},\"Feeds\"]},\"VariantQuery\"]},\"new\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"config\"]},{\"type\":\"lvar\",\"children\":[\"config\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"user\"]},{\"type\":\"ivar\",\"children\":[\"@user\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"number_of_articles\"]},{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"params\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"number_of_articles\"]}]},{\"type\":\"int\",\"children\":[25]}]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"page\"]},{\"type\":\"int\",\"children\":[1]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"tag\"]},{\"type\":\"nil\",\"children\":[]}]}]}]}]},{\"type\":\"ivasgn\",\"children\":[\"@articles\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@feed\"]},\"more_comments_minimal_weight_randomized\"]},\"to_a\"]}]}]},{\"type\":\"resbody\",\"children\":[{\"type\":\"array\",\"children\":[{\"type\":\"const\",\"children\":[null,\"KeyError\"]},{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"JSON\"]},\"ParserError\"]},{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"ActiveRecord\"]},\"StatementInvalid\"]}]},{\"type\":\"lvasgn\",\"children\":[\"e\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"flash\"]},\"[]=\",{\"type\":\"sym\",\"children\":[\"danger\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"e\"]},\"message\"]}]}]},null]}]}]}]}","id":"16ec8296-5337-41be-9d0f-2c79ed1ac187"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/lib/gitlab/git_access.rb","start_line":270,"raw_source":"def add_container_moved_message!\n      return if redirected_path.nil?\n\n      container_moved = Checks::ContainerMoved.new(repository, user, protocol, redirected_path)\n\n      container_moved.add_message\n    end","complexity_score":11.0,"ast_json":"{\"type\":\"def\",\"children\":[\"add_container_moved_message!\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"redirected_path\"]},\"nil?\"]},{\"type\":\"return\",\"children\":[]},null]},{\"type\":\"lvasgn\",\"children\":[\"container_moved\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Checks\"]},\"ContainerMoved\"]},\"new\",{\"type\":\"send\",\"children\":[null,\"repository\"]},{\"type\":\"send\",\"children\":[null,\"user\"]},{\"type\":\"send\",\"children\":[null,\"protocol\"]},{\"type\":\"send\",\"children\":[null,\"redirected_path\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"container_moved\"]},\"add_message\"]}]}]}","id":"0ddc3939-5564-40b4-ad50-f9ff4499611f"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/lib/gitlab/auth/oidc/step_up_authentication_flow.rb","start_line":35,"raw_source":"def evaluate!(oidc_id_token_claims)\n          oidc_id_token_claims =\n            ::Gitlab::Auth::Oidc::StepUpAuthentication.slice_relevant_id_token_claims(\n              oauth_raw_info: oidc_id_token_claims,\n              provider: provider,\n              scope: scope\n            )\n\n          if conditions_fulfilled?(oidc_id_token_claims)\n            succeed!\n          else\n            fail!\n          end\n        end","complexity_score":8.6,"ast_json":"{\"type\":\"def\",\"children\":[\"evaluate!\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"oidc_id_token_claims\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"oidc_id_token_claims\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"cbase\",\"children\":[]},\"Gitlab\"]},\"Auth\"]},\"Oidc\"]},\"StepUpAuthentication\"]},\"slice_relevant_id_token_claims\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"oauth_raw_info\"]},{\"type\":\"lvar\",\"children\":[\"oidc_id_token_claims\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"provider\"]},{\"type\":\"send\",\"children\":[null,\"provider\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"scope\"]},{\"type\":\"send\",\"children\":[null,\"scope\"]}]}]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"conditions_fulfilled?\",{\"type\":\"lvar\",\"children\":[\"oidc_id_token_claims\"]}]},{\"type\":\"send\",\"children\":[null,\"succeed!\"]},{\"type\":\"send\",\"children\":[null,\"fail!\"]}]}]}]}","id":"1be5670b-dc38-4f69-8291-6567372ac1b2"}
{"repo_name":"discourse","file_path":"./repos/discourse/plugins/discourse-gamification/lib/discourse_gamification/scorables/solutions.rb","start_line":12,"raw_source":"def self.category_filter\n      return \"\" if scorable_category_list.empty?\n\n      <<~SQL\n        AND topics.category_id IN (#{scorable_category_list})\n      SQL\n    end","complexity_score":4.2,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"category_filter\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"scorable_category_list\"]},\"empty?\"]},{\"type\":\"return\",\"children\":[{\"type\":\"str\",\"children\":[\"\"]}]},null]},{\"type\":\"dstr\",\"children\":[{\"type\":\"str\",\"children\":[\"AND topics.category_id IN (\"]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"scorable_category_list\"]}]},{\"type\":\"str\",\"children\":[\")\\n\"]}]}]}]}","id":"ff499672-57e5-4362-accb-2b9a708e83a5"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/services/ci/pipeline_schedules/variables_base_save_service.rb","start_line":29,"raw_source":"def forbidden_to_update_pipeline_schedule\n        # We add the error to the base object too\n        # because model errors are used in the API responses and the `form_errors` helper.\n        pipeline_schedule.errors.add(:base, authorize_message)\n\n        ServiceResponse.error(payload: pipeline_schedule, message: [authorize_message], reason: :forbidden)\n      end","complexity_score":8.2,"ast_json":"{\"type\":\"def\",\"children\":[\"forbidden_to_update_pipeline_schedule\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"pipeline_schedule\"]},\"errors\"]},\"add\",{\"type\":\"sym\",\"children\":[\"base\"]},{\"type\":\"send\",\"children\":[null,\"authorize_message\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"ServiceResponse\"]},\"error\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"payload\"]},{\"type\":\"send\",\"children\":[null,\"pipeline_schedule\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"message\"]},{\"type\":\"array\",\"children\":[{\"type\":\"send\",\"children\":[null,\"authorize_message\"]}]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"reason\"]},{\"type\":\"sym\",\"children\":[\"forbidden\"]}]}]}]}]}]}","id":"28bd9996-f46e-4ae5-a140-411974f51f30"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/scripts/internal_events/cli/flows/event_definer.rb","start_line":194,"raw_source":"def prompt_for_product_group\n        new_page!(on_step: 'Group', steps: STEPS)\n\n        product_group = prompt_for_group_ownership('Which group will own the event?')\n\n        event.product_group = product_group\n      end","complexity_score":5.0,"ast_json":"{\"type\":\"def\",\"children\":[\"prompt_for_product_group\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"new_page!\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"on_step\"]},{\"type\":\"str\",\"children\":[\"Group\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"steps\"]},{\"type\":\"const\",\"children\":[null,\"STEPS\"]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"product_group\",{\"type\":\"send\",\"children\":[null,\"prompt_for_group_ownership\",{\"type\":\"str\",\"children\":[\"Which group will own the event?\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"event\"]},\"product_group=\",{\"type\":\"lvar\",\"children\":[\"product_group\"]}]}]}]}","id":"c4ac95cc-5728-4316-b6e2-11a0b7408e8e"}
{"repo_name":"rails","file_path":"./repos/rails/actionpack/test/routing/helper_test.rb","start_line":14,"raw_source":"def test_exception\n        rs = ::ActionDispatch::Routing::RouteSet.new\n        rs.draw do\n          resources :ducks do\n            member do\n              get :pond\n            end\n          end\n        end\n\n        x = Class.new {\n          include rs.url_helpers\n        }\n        assert_raises ActionController::UrlGenerationError do\n          x.new.pond_duck_path Duck.new\n        end\n      end","complexity_score":22.1,"ast_json":"{\"type\":\"def\",\"children\":[\"test_exception\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"rs\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"cbase\",\"children\":[]},\"ActionDispatch\"]},\"Routing\"]},\"RouteSet\"]},\"new\"]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"rs\"]},\"draw\"]},{\"type\":\"args\",\"children\":[]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"resources\",{\"type\":\"sym\",\"children\":[\"ducks\"]}]},{\"type\":\"args\",\"children\":[]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"member\"]},{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[null,\"get\",{\"type\":\"sym\",\"children\":[\"pond\"]}]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"x\",{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Class\"]},\"new\"]},{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[null,\"include\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"rs\"]},\"url_helpers\"]}]}]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"assert_raises\",{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"ActionController\"]},\"UrlGenerationError\"]}]},{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"x\"]},\"new\"]},\"pond_duck_path\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Duck\"]},\"new\"]}]}]}]}]}","id":"5c65ef6c-10f1-4f63-a0fa-30b619af7b8c"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/lib/sidebars/groups/menus/work_items_menu.rb","start_line":82,"raw_source":"def boards_menu_item\n          unless can?(context.current_user, :read_group_boards, context.group)\n            return ::Sidebars::NilMenuItem.new(item_id: :boards)\n          end\n\n          title = if context.is_super_sidebar\n                    context.group.multiple_issue_boards_available? ? s_('Issue boards') : s_('Issue board')\n                  else\n                    context.group.multiple_issue_boards_available? ? s_('Boards|Boards') : s_('Boards|Board')\n                  end\n\n          ::Sidebars::MenuItem.new(\n            title: title,\n            link: group_boards_path(context.group),\n            super_sidebar_parent: ::Sidebars::Groups::SuperSidebarMenus::PlanMenu,\n            active_routes: { path: %w[boards#index boards#show] },\n            item_id: context.is_super_sidebar ? :issue_boards : :boards\n          )\n        end","complexity_score":36.3,"ast_json":"{\"type\":\"def\",\"children\":[\"boards_menu_item\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"can?\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"context\"]},\"current_user\"]},{\"type\":\"sym\",\"children\":[\"read_group_boards\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"context\"]},\"group\"]}]},null,{\"type\":\"return\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"cbase\",\"children\":[]},\"Sidebars\"]},\"NilMenuItem\"]},\"new\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"item_id\"]},{\"type\":\"sym\",\"children\":[\"boards\"]}]}]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"title\",{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"context\"]},\"is_super_sidebar\"]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"context\"]},\"group\"]},\"multiple_issue_boards_available?\"]},{\"type\":\"send\",\"children\":[null,\"s_\",{\"type\":\"str\",\"children\":[\"Issue boards\"]}]},{\"type\":\"send\",\"children\":[null,\"s_\",{\"type\":\"str\",\"children\":[\"Issue board\"]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"context\"]},\"group\"]},\"multiple_issue_boards_available?\"]},{\"type\":\"send\",\"children\":[null,\"s_\",{\"type\":\"str\",\"children\":[\"Boards|Boards\"]}]},{\"type\":\"send\",\"children\":[null,\"s_\",{\"type\":\"str\",\"children\":[\"Boards|Board\"]}]}]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"cbase\",\"children\":[]},\"Sidebars\"]},\"MenuItem\"]},\"new\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"title\"]},{\"type\":\"lvar\",\"children\":[\"title\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"link\"]},{\"type\":\"send\",\"children\":[null,\"group_boards_path\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"context\"]},\"group\"]}]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"super_sidebar_parent\"]},{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"cbase\",\"children\":[]},\"Sidebars\"]},\"Groups\"]},\"SuperSidebarMenus\"]},\"PlanMenu\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"active_routes\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"path\"]},{\"type\":\"array\",\"children\":[{\"type\":\"str\",\"children\":[\"boards#index\"]},{\"type\":\"str\",\"children\":[\"boards#show\"]}]}]}]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"item_id\"]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"context\"]},\"is_super_sidebar\"]},{\"type\":\"sym\",\"children\":[\"issue_boards\"]},{\"type\":\"sym\",\"children\":[\"boards\"]}]}]}]}]}]}]}","id":"d85498d3-9fb5-4b74-93e6-b87d6a6196d8"}
{"repo_name":"mastodon","file_path":"./repos/mastodon/app/models/notification.rb","start_line":191,"raw_source":"def set_from_account\n    return unless new_record?\n\n    case activity_type\n    when 'Status', 'Follow', 'Favourite', 'FollowRequest', 'Poll', 'Report'\n      self.from_account_id = activity&.account_id\n    when 'Mention'\n      self.from_account_id = activity&.status&.account_id\n    when 'Account'\n      self.from_account_id = activity&.id\n    when 'AccountRelationshipSeveranceEvent', 'AccountWarning', 'GeneratedAnnualReport'\n      # These do not really have an originating account, but this is mandatory\n      # in the data model, and the recipient's account will by definition\n      # always exist\n      self.from_account_id = account_id\n    end\n  end","complexity_score":24.3,"ast_json":"{\"type\":\"def\",\"children\":[\"set_from_account\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"new_record?\"]},null,{\"type\":\"return\",\"children\":[]}]},{\"type\":\"case\",\"children\":[{\"type\":\"send\",\"children\":[null,\"activity_type\"]},{\"type\":\"when\",\"children\":[{\"type\":\"str\",\"children\":[\"Status\"]},{\"type\":\"str\",\"children\":[\"Follow\"]},{\"type\":\"str\",\"children\":[\"Favourite\"]},{\"type\":\"str\",\"children\":[\"FollowRequest\"]},{\"type\":\"str\",\"children\":[\"Poll\"]},{\"type\":\"str\",\"children\":[\"Report\"]},{\"type\":\"send\",\"children\":[{\"type\":\"self\",\"children\":[]},\"from_account_id=\",{\"type\":\"csend\",\"children\":[{\"type\":\"send\",\"children\":[null,\"activity\"]},\"account_id\"]}]}]},{\"type\":\"when\",\"children\":[{\"type\":\"str\",\"children\":[\"Mention\"]},{\"type\":\"send\",\"children\":[{\"type\":\"self\",\"children\":[]},\"from_account_id=\",{\"type\":\"csend\",\"children\":[{\"type\":\"csend\",\"children\":[{\"type\":\"send\",\"children\":[null,\"activity\"]},\"status\"]},\"account_id\"]}]}]},{\"type\":\"when\",\"children\":[{\"type\":\"str\",\"children\":[\"Account\"]},{\"type\":\"send\",\"children\":[{\"type\":\"self\",\"children\":[]},\"from_account_id=\",{\"type\":\"csend\",\"children\":[{\"type\":\"send\",\"children\":[null,\"activity\"]},\"id\"]}]}]},{\"type\":\"when\",\"children\":[{\"type\":\"str\",\"children\":[\"AccountRelationshipSeveranceEvent\"]},{\"type\":\"str\",\"children\":[\"AccountWarning\"]},{\"type\":\"str\",\"children\":[\"GeneratedAnnualReport\"]},{\"type\":\"send\",\"children\":[{\"type\":\"self\",\"children\":[]},\"from_account_id=\",{\"type\":\"send\",\"children\":[null,\"account_id\"]}]}]},null]}]}]}","id":"86b1552b-39c3-4606-b3f8-db3b611bc81f"}
