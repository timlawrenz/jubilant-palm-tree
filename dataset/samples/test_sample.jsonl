{"repo_name":"forem","file_path":"./repos/forem/app/services/moderator/banish_user.rb","start_line":49,"raw_source":"def delete_vomit_reactions\n      Reaction.where(reactable: user, category: \"vomit\").delete_all\n    end","complexity_score":3.6,"ast_json":"{\"type\":\"def\",\"children\":[\"delete_vomit_reactions\",{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Reaction\"]},\"where\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"reactable\"]},{\"type\":\"send\",\"children\":[null,\"user\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"category\"]},{\"type\":\"str\",\"children\":[\"vomit\"]}]}]}]},\"delete_all\"]}]}","id":"948d5e62-c1f8-476a-bbc5-ef8cadd01583"}
{"repo_name":"fastlane","file_path":"./repos/fastlane/fastlane/lib/fastlane/server/json_return_value_processor.rb","start_line":54,"raw_source":"def process_value_as_bool(return_value: nil)\n      if return_value.nil?\n        return_value = false\n      end\n\n      # quirks_mode because sometimes the built-in library is used for some folks and that needs quirks_mode: true\n      return JSON.generate(return_value.to_s, quirks_mode: true)\n    end","complexity_score":5.3,"ast_json":"{\"type\":\"def\",\"children\":[\"process_value_as_bool\",{\"type\":\"args\",\"children\":[{\"type\":\"kwoptarg\",\"children\":[\"return_value\",{\"type\":\"nil\",\"children\":[]}]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"return_value\"]},\"nil?\"]},{\"type\":\"lvasgn\",\"children\":[\"return_value\",{\"type\":\"false\",\"children\":[]}]},null]},{\"type\":\"return\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"JSON\"]},\"generate\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"return_value\"]},\"to_s\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"quirks_mode\"]},{\"type\":\"true\",\"children\":[]}]}]}]}]}]}]}","id":"cf6f205b-422a-4f41-a753-efb8a7e3aef9"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/lib/gitlab/graphql/query_analyzers/ast/recursion_analyzer.rb","start_line":33,"raw_source":"def on_leave_field(node, _parent, visitor)\n            return if skip_node?(node, visitor)\n\n            node_name = node.name\n            node_visits[node_name] ||= 0\n            node_visits[node_name] -= 1\n          end","complexity_score":6.25,"ast_json":"{\"type\":\"def\",\"children\":[\"on_leave_field\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"node\"]},{\"type\":\"arg\",\"children\":[\"_parent\"]},{\"type\":\"arg\",\"children\":[\"visitor\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[null,\"skip_node?\",{\"type\":\"lvar\",\"children\":[\"node\"]},{\"type\":\"lvar\",\"children\":[\"visitor\"]}]},{\"type\":\"return\",\"children\":[]},null]},{\"type\":\"lvasgn\",\"children\":[\"node_name\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"node\"]},\"name\"]}]},{\"type\":\"or_asgn\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"node_visits\"]},\"[]\",{\"type\":\"lvar\",\"children\":[\"node_name\"]}]},{\"type\":\"int\",\"children\":[0]}]},{\"type\":\"op_asgn\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"node_visits\"]},\"[]\",{\"type\":\"lvar\",\"children\":[\"node_name\"]}]},\"-\",{\"type\":\"int\",\"children\":[1]}]}]}]}","id":"50c58224-863c-42c4-a596-2ce95773c755"}
{"repo_name":"sidekiq","file_path":"./repos/sidekiq/lib/sidekiq/config.rb","start_line":214,"raw_source":"def lookup(name, default_class = nil)\n      # JNDI is just a fancy name for a hash lookup\n      @directory.fetch(name) do |key|\n        return nil unless default_class\n        register(key, default_class.new(self))\n      end\n    end","complexity_score":6.8,"ast_json":"{\"type\":\"def\",\"children\":[\"lookup\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"name\"]},{\"type\":\"optarg\",\"children\":[\"default_class\",{\"type\":\"nil\",\"children\":[]}]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@directory\"]},\"fetch\",{\"type\":\"lvar\",\"children\":[\"name\"]}]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"key\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"lvar\",\"children\":[\"default_class\"]},null,{\"type\":\"return\",\"children\":[{\"type\":\"nil\",\"children\":[]}]}]},{\"type\":\"send\",\"children\":[null,\"register\",{\"type\":\"lvar\",\"children\":[\"key\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"default_class\"]},\"new\",{\"type\":\"self\",\"children\":[]}]}]}]}]}]}","id":"01d6eacd-0daa-4ab0-b9a8-d75c2c93ccdb"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/spec/support/shared_examples/graphql/boards_shared_examples.rb","start_line":51,"raw_source":"def visit_board\n    if board_type == 'group'\n      create(:board_group_recent_visit, group: parent, board: board, user: user)\n    else\n      create(:board_project_recent_visit, project: parent, board: board, user: user)\n    end\n  end","complexity_score":13.2,"ast_json":"{\"type\":\"def\",\"children\":[\"visit_board\",{\"type\":\"args\",\"children\":[]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"board_type\"]},\"==\",{\"type\":\"str\",\"children\":[\"group\"]}]},{\"type\":\"send\",\"children\":[null,\"create\",{\"type\":\"sym\",\"children\":[\"board_group_recent_visit\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"group\"]},{\"type\":\"send\",\"children\":[null,\"parent\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"board\"]},{\"type\":\"send\",\"children\":[null,\"board\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"user\"]},{\"type\":\"send\",\"children\":[null,\"user\"]}]}]}]},{\"type\":\"send\",\"children\":[null,\"create\",{\"type\":\"sym\",\"children\":[\"board_project_recent_visit\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"project\"]},{\"type\":\"send\",\"children\":[null,\"parent\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"board\"]},{\"type\":\"send\",\"children\":[null,\"board\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"user\"]},{\"type\":\"send\",\"children\":[null,\"user\"]}]}]}]}]}]}","id":"63395241-5215-4044-bfef-3be7a771b8f9"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/db/fixtures/development/17_cycle_analytics.rb","start_line":174,"raw_source":"def seed_review_stage!\n    merge_requests.each do |merge_request|\n      merge_request.metrics.update!(\n        merged_at: within_end_time(merge_request.created_at + MAX_DURATIONS[:review].hours)\n      )\n    end\n  end","complexity_score":13.7,"ast_json":"{\"type\":\"def\",\"children\":[\"seed_review_stage!\",{\"type\":\"args\",\"children\":[]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"merge_requests\"]},\"each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"merge_request\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"merge_request\"]},\"metrics\"]},\"update!\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"merged_at\"]},{\"type\":\"send\",\"children\":[null,\"within_end_time\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"merge_request\"]},\"created_at\"]},\"+\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"MAX_DURATIONS\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"review\"]}]},\"hours\"]}]}]}]}]}]}]}]}","id":"df544024-a492-422b-8d19-f36d36dcef2d"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/qa/gems/gitlab-orchestrator/lib/gitlab/orchestrator/lib/kubectl/resources/configmap.rb","start_line":15,"raw_source":"def initialize(resource_name, key, value)\n            super(resource_name)\n\n            @key = key\n            @value = value\n          end","complexity_score":3.0,"ast_json":"{\"type\":\"def\",\"children\":[\"initialize\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"resource_name\"]},{\"type\":\"arg\",\"children\":[\"key\"]},{\"type\":\"arg\",\"children\":[\"value\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"super\",\"children\":[{\"type\":\"lvar\",\"children\":[\"resource_name\"]}]},{\"type\":\"ivasgn\",\"children\":[\"@key\",{\"type\":\"lvar\",\"children\":[\"key\"]}]},{\"type\":\"ivasgn\",\"children\":[\"@value\",{\"type\":\"lvar\",\"children\":[\"value\"]}]}]}]}","id":"907a0eb6-755c-44d5-a73d-f7b7717dee0e"}
{"repo_name":"manageiq","file_path":"./repos/manageiq/lib/tasks/test_security_helper.rb","start_line":132,"raw_source":"def self.all(format: \"human\")\n    success = %i[bundle_audit brakeman yarn_audit].map do |suite|\n      public_send(suite, format: format)\n      true\n    rescue SecurityTestFailed\n      false\n    ensure\n      puts\n    end.all?\n\n    raise SecurityTestFailed unless success\n  end","complexity_score":10.6,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"all\",{\"type\":\"args\",\"children\":[{\"type\":\"kwoptarg\",\"children\":[\"format\",{\"type\":\"str\",\"children\":[\"human\"]}]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"success\",{\"type\":\"send\",\"children\":[{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"array\",\"children\":[{\"type\":\"sym\",\"children\":[\"bundle_audit\"]},{\"type\":\"sym\",\"children\":[\"brakeman\"]},{\"type\":\"sym\",\"children\":[\"yarn_audit\"]}]},\"map\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"suite\"]}]},{\"type\":\"ensure\",\"children\":[{\"type\":\"rescue\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"public_send\",{\"type\":\"lvar\",\"children\":[\"suite\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"format\"]},{\"type\":\"lvar\",\"children\":[\"format\"]}]}]}]},{\"type\":\"true\",\"children\":[]}]},{\"type\":\"resbody\",\"children\":[{\"type\":\"array\",\"children\":[{\"type\":\"const\",\"children\":[null,\"SecurityTestFailed\"]}]},null,{\"type\":\"false\",\"children\":[]}]},null]},{\"type\":\"send\",\"children\":[null,\"puts\"]}]}]},\"all?\"]}]},{\"type\":\"if\",\"children\":[{\"type\":\"lvar\",\"children\":[\"success\"]},null,{\"type\":\"send\",\"children\":[null,\"raise\",{\"type\":\"const\",\"children\":[null,\"SecurityTestFailed\"]}]}]}]}]}","id":"f32f50e0-f6c5-4359-b946-454ca955923a"}
{"repo_name":"puma","file_path":"./repos/puma/test/test_redirect_io.rb","start_line":40,"raw_source":"def test_sighup_redirects_io_single\n    skip_if :jruby # Server isn't coming up in CI, TODO Fix\n\n    cli_server @cli_args.join ' '\n\n    rotate_check_logs\n  end","complexity_score":4.2,"ast_json":"{\"type\":\"def\",\"children\":[\"test_sighup_redirects_io_single\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"skip_if\",{\"type\":\"sym\",\"children\":[\"jruby\"]}]},{\"type\":\"send\",\"children\":[null,\"cli_server\",{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@cli_args\"]},\"join\",{\"type\":\"str\",\"children\":[\" \"]}]}]},{\"type\":\"send\",\"children\":[null,\"rotate_check_logs\"]}]}]}","id":"08b3a26a-ee21-4235-a9ed-ad13e1b2fea3"}
{"repo_name":"discourse","file_path":"./repos/discourse/script/import_scripts/quandora/quandora_api.rb","start_line":49,"raw_source":"def get_question(question_id)\n    url = \"#{base_url @domain}/q/#{question_id}\"\n    response = request url\n    response[\"data\"]\n  end","complexity_score":5.0,"ast_json":"{\"type\":\"def\",\"children\":[\"get_question\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"question_id\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"url\",{\"type\":\"dstr\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[null,\"base_url\",{\"type\":\"ivar\",\"children\":[\"@domain\"]}]}]},{\"type\":\"str\",\"children\":[\"/q/\"]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvar\",\"children\":[\"question_id\"]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"response\",{\"type\":\"send\",\"children\":[null,\"request\",{\"type\":\"lvar\",\"children\":[\"url\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"response\"]},\"[]\",{\"type\":\"str\",\"children\":[\"data\"]}]}]}]}","id":"888e7f5c-e082-40a7-b481-88513c126867"}
{"repo_name":"discourse","file_path":"./repos/discourse/app/models/theme.rb","start_line":196,"raw_source":"def update_child_components\n    if !component? && child_components.present? && !skip_child_components_update\n      child_components.each do |url|\n        url = ThemeStore::GitImporter.new(url.strip).url\n        theme = RemoteTheme.find_by(remote_url: url)&.theme\n        theme ||= RemoteTheme.import_theme(url, user)\n        child_themes << theme\n      end\n    end\n  end","complexity_score":31.1,"ast_json":"{\"type\":\"def\",\"children\":[\"update_child_components\",{\"type\":\"args\",\"children\":[]},{\"type\":\"if\",\"children\":[{\"type\":\"and\",\"children\":[{\"type\":\"and\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"component?\"]},\"!\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"child_components\"]},\"present?\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"skip_child_components_update\"]},\"!\"]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"child_components\"]},\"each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"url\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"url\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[{\"type\":\"const\",\"children\":[null,\"ThemeStore\"]},\"GitImporter\"]},\"new\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"url\"]},\"strip\"]}]},\"url\"]}]},{\"type\":\"lvasgn\",\"children\":[\"theme\",{\"type\":\"csend\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"RemoteTheme\"]},\"find_by\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"remote_url\"]},{\"type\":\"lvar\",\"children\":[\"url\"]}]}]}]},\"theme\"]}]},{\"type\":\"or_asgn\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"theme\"]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"RemoteTheme\"]},\"import_theme\",{\"type\":\"lvar\",\"children\":[\"url\"]},{\"type\":\"send\",\"children\":[null,\"user\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"child_themes\"]},\"<<\",{\"type\":\"lvar\",\"children\":[\"theme\"]}]}]}]},null]}]}","id":"2573fa19-bfea-4da5-9443-f10ee4de6987"}
{"repo_name":"rails","file_path":"./repos/rails/guides/rails_guides/markdown.rb","start_line":35,"raw_source":"def dom_id(nodes)\n        dom_id = dom_id_text(nodes.last.text)\n\n        # Fix duplicate dom_ids by prefixing the parent node dom_id\n        if @node_ids[dom_id]\n          if @node_ids[dom_id].size > 1\n            duplicate_nodes = @node_ids.delete(dom_id)\n            new_node_id = dom_id_with_parent_node(dom_id, duplicate_nodes[-2])\n            duplicate_nodes.last[:id] = new_node_id\n            @node_ids[new_node_id] = duplicate_nodes\n          end\n          dom_id = dom_id_with_parent_node(dom_id, nodes[-2])\n        end\n\n        @node_ids[dom_id] = nodes\n        dom_id\n      end","complexity_score":29.4,"ast_json":"{\"type\":\"def\",\"children\":[\"dom_id\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"nodes\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"dom_id\",{\"type\":\"send\",\"children\":[null,\"dom_id_text\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"nodes\"]},\"last\"]},\"text\"]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@node_ids\"]},\"[]\",{\"type\":\"lvar\",\"children\":[\"dom_id\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@node_ids\"]},\"[]\",{\"type\":\"lvar\",\"children\":[\"dom_id\"]}]},\"size\"]},\">\",{\"type\":\"int\",\"children\":[1]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"duplicate_nodes\",{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@node_ids\"]},\"delete\",{\"type\":\"lvar\",\"children\":[\"dom_id\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"new_node_id\",{\"type\":\"send\",\"children\":[null,\"dom_id_with_parent_node\",{\"type\":\"lvar\",\"children\":[\"dom_id\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"duplicate_nodes\"]},\"[]\",{\"type\":\"int\",\"children\":[-2]}]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"duplicate_nodes\"]},\"last\"]},\"[]=\",{\"type\":\"sym\",\"children\":[\"id\"]},{\"type\":\"lvar\",\"children\":[\"new_node_id\"]}]},{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@node_ids\"]},\"[]=\",{\"type\":\"lvar\",\"children\":[\"new_node_id\"]},{\"type\":\"lvar\",\"children\":[\"duplicate_nodes\"]}]}]},null]},{\"type\":\"lvasgn\",\"children\":[\"dom_id\",{\"type\":\"send\",\"children\":[null,\"dom_id_with_parent_node\",{\"type\":\"lvar\",\"children\":[\"dom_id\"]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"nodes\"]},\"[]\",{\"type\":\"int\",\"children\":[-2]}]}]}]}]},null]},{\"type\":\"send\",\"children\":[{\"type\":\"ivar\",\"children\":[\"@node_ids\"]},\"[]=\",{\"type\":\"lvar\",\"children\":[\"dom_id\"]},{\"type\":\"lvar\",\"children\":[\"nodes\"]}]},{\"type\":\"lvar\",\"children\":[\"dom_id\"]}]}]}","id":"7ad4544e-e842-457a-94fb-338b50443132"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/models/authentication_event.rb","start_line":27,"raw_source":"def self.providers\n    STATIC_PROVIDERS | Devise.omniauth_providers.map(&:to_s)\n  end","complexity_score":5.0,"ast_json":"{\"type\":\"defs\",\"children\":[{\"type\":\"self\",\"children\":[]},\"providers\",{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"STATIC_PROVIDERS\"]},\"|\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Devise\"]},\"omniauth_providers\"]},\"map\",{\"type\":\"block_pass\",\"children\":[{\"type\":\"sym\",\"children\":[\"to_s\"]}]}]}]}]}","id":"7e7a505e-a8f7-4eb2-a38b-323104577554"}
{"repo_name":"multiwoven","file_path":"./repos/multiwoven/integrations/lib/multiwoven/integrations/source/postgresql/client.rb","start_line":21,"raw_source":"def discover(connection_config)\n        connection_config = connection_config.with_indifferent_access\n        query = \"SELECT table_name, column_name,\n                 CASE WHEN data_type = 'USER-DEFINED' THEN udt_name ELSE data_type END\n                 AS data_type,\n                 is_nullable\n                 FROM information_schema.columns\n                 WHERE table_schema = '#{connection_config[:schema]}' AND table_catalog = '#{connection_config[:database]}'\n                 ORDER BY table_name, ordinal_position;\"\n\n        db = create_connection(connection_config)\n        records = db.exec(query) do |result|\n          result.map do |row|\n            row\n          end\n        end\n        catalog = Catalog.new(streams: create_streams(records))\n        catalog.to_multiwoven_message\n      rescue StandardError => e\n        handle_exception(e, {\n                           context: \"POSTGRESQL:DISCOVER:EXCEPTION\",\n                           type: \"error\"\n                         })\n      ensure\n        db&.close\n      end","complexity_score":23.8,"ast_json":"{\"type\":\"def\",\"children\":[\"discover\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"connection_config\"]}]},{\"type\":\"ensure\",\"children\":[{\"type\":\"rescue\",\"children\":[{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"connection_config\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"connection_config\"]},\"with_indifferent_access\"]}]},{\"type\":\"lvasgn\",\"children\":[\"query\",{\"type\":\"dstr\",\"children\":[{\"type\":\"str\",\"children\":[\"SELECT table_name, column_name,\\n\"]},{\"type\":\"str\",\"children\":[\"                 CASE WHEN data_type = 'USER-DEFINED' THEN udt_name ELSE data_type END\\n\"]},{\"type\":\"str\",\"children\":[\"                 AS data_type,\\n\"]},{\"type\":\"str\",\"children\":[\"                 is_nullable\\n\"]},{\"type\":\"str\",\"children\":[\"                 FROM information_schema.columns\\n\"]},{\"type\":\"str\",\"children\":[\"                 WHERE table_schema = '\"]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"connection_config\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"schema\"]}]}]},{\"type\":\"str\",\"children\":[\"' AND table_catalog = '\"]},{\"type\":\"begin\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"connection_config\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"database\"]}]}]},{\"type\":\"str\",\"children\":[\"'\\n\"]},{\"type\":\"str\",\"children\":[\"                 ORDER BY table_name, ordinal_position;\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"db\",{\"type\":\"send\",\"children\":[null,\"create_connection\",{\"type\":\"lvar\",\"children\":[\"connection_config\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"records\",{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"db\"]},\"exec\",{\"type\":\"lvar\",\"children\":[\"query\"]}]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"result\"]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"result\"]},\"map\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"row\"]}]},{\"type\":\"lvar\",\"children\":[\"row\"]}]}]}]},{\"type\":\"lvasgn\",\"children\":[\"catalog\",{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Catalog\"]},\"new\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"streams\"]},{\"type\":\"send\",\"children\":[null,\"create_streams\",{\"type\":\"lvar\",\"children\":[\"records\"]}]}]}]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"catalog\"]},\"to_multiwoven_message\"]}]},{\"type\":\"resbody\",\"children\":[{\"type\":\"array\",\"children\":[{\"type\":\"const\",\"children\":[null,\"StandardError\"]}]},{\"type\":\"lvasgn\",\"children\":[\"e\"]},{\"type\":\"send\",\"children\":[null,\"handle_exception\",{\"type\":\"lvar\",\"children\":[\"e\"]},{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"context\"]},{\"type\":\"str\",\"children\":[\"POSTGRESQL:DISCOVER:EXCEPTION\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"type\"]},{\"type\":\"str\",\"children\":[\"error\"]}]}]}]}]},null]},{\"type\":\"csend\",\"children\":[{\"type\":\"lvar\",\"children\":[\"db\"]},\"close\"]}]}]}","id":"7134fa75-9655-45a5-896c-f5ed03c87369"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/app/helpers/integrations_helper.rb","start_line":266,"raw_source":"def add_to_slack_link_redirect_url(parent)\n    case parent\n    when Project\n      slack_auth_project_settings_slack_url(parent)\n    when Group\n      slack_auth_group_settings_slack_url(parent)\n    when nil\n      slack_auth_admin_application_settings_slack_url\n    end\n  end","complexity_score":7.9,"ast_json":"{\"type\":\"def\",\"children\":[\"add_to_slack_link_redirect_url\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"parent\"]}]},{\"type\":\"case\",\"children\":[{\"type\":\"lvar\",\"children\":[\"parent\"]},{\"type\":\"when\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Project\"]},{\"type\":\"send\",\"children\":[null,\"slack_auth_project_settings_slack_url\",{\"type\":\"lvar\",\"children\":[\"parent\"]}]}]},{\"type\":\"when\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Group\"]},{\"type\":\"send\",\"children\":[null,\"slack_auth_group_settings_slack_url\",{\"type\":\"lvar\",\"children\":[\"parent\"]}]}]},{\"type\":\"when\",\"children\":[{\"type\":\"nil\",\"children\":[]},{\"type\":\"send\",\"children\":[null,\"slack_auth_admin_application_settings_slack_url\"]}]},null]}]}","id":"6c35bcb7-4d19-4a6b-9c67-46e792d62d9d"}
{"repo_name":"mastodon","file_path":"./repos/mastodon/lib/active_record/batches.rb","start_line":5,"raw_source":"def pluck_each(*column_names)\n      relation = self\n\n      options = column_names.extract_options!\n\n      flatten     = column_names.size == 1\n      batch_limit = options[:batch_limit] || 1_000\n      order       = options[:order] || :asc\n\n      column_names.unshift(primary_key)\n\n      cursor = Array(primary_key)\n\n      relation = relation.reorder(build_batch_orders(cursor, order).to_h).limit(batch_limit)\n      relation.skip_query_cache!\n\n      batch_relation = relation\n\n      loop do\n        batch = batch_relation.pluck(*column_names)\n\n        break if batch.empty?\n\n        primary_key_offset = batch.last[0]\n\n        batch.each do |record|\n          if flatten\n            yield record[1]\n          else\n            yield record[1..]\n          end\n        end\n\n        break if batch.size < batch_limit\n\n        batch_relation = relation.where(\n          predicate_builder[primary_key, primary_key_offset, order == :desc ? :lt : :gt]\n        )\n      end\n    end","complexity_score":61.28,"ast_json":"{\"type\":\"def\",\"children\":[\"pluck_each\",{\"type\":\"args\",\"children\":[{\"type\":\"restarg\",\"children\":[\"column_names\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"relation\",{\"type\":\"self\",\"children\":[]}]},{\"type\":\"lvasgn\",\"children\":[\"options\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"column_names\"]},\"extract_options!\"]}]},{\"type\":\"lvasgn\",\"children\":[\"flatten\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"column_names\"]},\"size\"]},\"==\",{\"type\":\"int\",\"children\":[1]}]}]},{\"type\":\"lvasgn\",\"children\":[\"batch_limit\",{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"options\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"batch_limit\"]}]},{\"type\":\"int\",\"children\":[1000]}]}]},{\"type\":\"lvasgn\",\"children\":[\"order\",{\"type\":\"or\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"options\"]},\"[]\",{\"type\":\"sym\",\"children\":[\"order\"]}]},{\"type\":\"sym\",\"children\":[\"asc\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"column_names\"]},\"unshift\",{\"type\":\"send\",\"children\":[null,\"primary_key\"]}]},{\"type\":\"lvasgn\",\"children\":[\"cursor\",{\"type\":\"send\",\"children\":[null,\"Array\",{\"type\":\"send\",\"children\":[null,\"primary_key\"]}]}]},{\"type\":\"lvasgn\",\"children\":[\"relation\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"relation\"]},\"reorder\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"build_batch_orders\",{\"type\":\"lvar\",\"children\":[\"cursor\"]},{\"type\":\"lvar\",\"children\":[\"order\"]}]},\"to_h\"]}]},\"limit\",{\"type\":\"lvar\",\"children\":[\"batch_limit\"]}]}]},{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"relation\"]},\"skip_query_cache!\"]},{\"type\":\"lvasgn\",\"children\":[\"batch_relation\",{\"type\":\"lvar\",\"children\":[\"relation\"]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"loop\"]},{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"batch\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"batch_relation\"]},\"pluck\",{\"type\":\"splat\",\"children\":[{\"type\":\"lvar\",\"children\":[\"column_names\"]}]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"batch\"]},\"empty?\"]},{\"type\":\"break\",\"children\":[]},null]},{\"type\":\"lvasgn\",\"children\":[\"primary_key_offset\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"batch\"]},\"last\"]},\"[]\",{\"type\":\"int\",\"children\":[0]}]}]},{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"batch\"]},\"each\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"record\"]}]},{\"type\":\"if\",\"children\":[{\"type\":\"lvar\",\"children\":[\"flatten\"]},{\"type\":\"yield\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"record\"]},\"[]\",{\"type\":\"int\",\"children\":[1]}]}]},{\"type\":\"yield\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"record\"]},\"[]\",{\"type\":\"irange\",\"children\":[{\"type\":\"int\",\"children\":[1]},null]}]}]}]}]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"batch\"]},\"size\"]},\"<\",{\"type\":\"lvar\",\"children\":[\"batch_limit\"]}]},{\"type\":\"break\",\"children\":[]},null]},{\"type\":\"lvasgn\",\"children\":[\"batch_relation\",{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"relation\"]},\"where\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"predicate_builder\"]},\"[]\",{\"type\":\"send\",\"children\":[null,\"primary_key\"]},{\"type\":\"lvar\",\"children\":[\"primary_key_offset\"]},{\"type\":\"if\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"order\"]},\"==\",{\"type\":\"sym\",\"children\":[\"desc\"]}]},{\"type\":\"sym\",\"children\":[\"lt\"]},{\"type\":\"sym\",\"children\":[\"gt\"]}]}]}]}]}]}]}]}]}","id":"62281e1f-fe8a-4c85-a138-9fa3df68860f"}
{"repo_name":"rails","file_path":"./repos/rails/activerecord/test/cases/associations/has_one_through_associations_test.rb","start_line":201,"raw_source":"def test_eager_has_one_through_polymorphic_with_source_type\n    clubs = Club.all.merge!(includes: :sponsored_member, where: [\"name = ?\", \"Moustache and Eyebrow Fancier Club\"]).to_a\n    # Only the eyebrow fanciers club has a sponsored_member\n    assert_not_nil assert_no_queries { clubs[0].sponsored_member }\n  end","complexity_score":10.8,"ast_json":"{\"type\":\"def\",\"children\":[\"test_eager_has_one_through_polymorphic_with_source_type\",{\"type\":\"args\",\"children\":[]},{\"type\":\"begin\",\"children\":[{\"type\":\"lvasgn\",\"children\":[\"clubs\",{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Club\"]},\"all\"]},\"merge!\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"includes\"]},{\"type\":\"sym\",\"children\":[\"sponsored_member\"]}]},{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"where\"]},{\"type\":\"array\",\"children\":[{\"type\":\"str\",\"children\":[\"name = ?\"]},{\"type\":\"str\",\"children\":[\"Moustache and Eyebrow Fancier Club\"]}]}]}]}]},\"to_a\"]}]},{\"type\":\"send\",\"children\":[null,\"assert_not_nil\",{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[null,\"assert_no_queries\"]},{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"clubs\"]},\"[]\",{\"type\":\"int\",\"children\":[0]}]},\"sponsored_member\"]}]}]}]}]}","id":"7a0c92c6-cdcb-49dc-9c4c-7df7963d26b5"}
{"repo_name":"rubocop","file_path":"./repos/rubocop/lib/rubocop/cop/style/bisected_attr_accessor/macro.rb","start_line":19,"raw_source":"def initialize(node)\n            @node = node\n            @attrs = node.arguments.to_h { |attr| [attr.source, attr] }\n            @bisection = []\n          end","complexity_score":7.3,"ast_json":"{\"type\":\"def\",\"children\":[\"initialize\",{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"node\"]}]},{\"type\":\"begin\",\"children\":[{\"type\":\"ivasgn\",\"children\":[\"@node\",{\"type\":\"lvar\",\"children\":[\"node\"]}]},{\"type\":\"ivasgn\",\"children\":[\"@attrs\",{\"type\":\"block\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"node\"]},\"arguments\"]},\"to_h\"]},{\"type\":\"args\",\"children\":[{\"type\":\"arg\",\"children\":[\"attr\"]}]},{\"type\":\"array\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"lvar\",\"children\":[\"attr\"]},\"source\"]},{\"type\":\"lvar\",\"children\":[\"attr\"]}]}]}]},{\"type\":\"ivasgn\",\"children\":[\"@bisection\",{\"type\":\"array\",\"children\":[]}]}]}]}","id":"401a57da-113b-4bbc-8c02-b933cc8430ff"}
{"repo_name":"rails","file_path":"./repos/rails/activerecord/test/cases/relation/with_test.rb","start_line":72,"raw_source":"def test_with_when_called_from_active_record_scope\n        assert_equal POSTS_WITH_TAGS, Post.with_tags_cte.order(:id).pluck(:id)\n      end","complexity_score":5.2,"ast_json":"{\"type\":\"def\",\"children\":[\"test_with_when_called_from_active_record_scope\",{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[null,\"assert_equal\",{\"type\":\"const\",\"children\":[null,\"POSTS_WITH_TAGS\"]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"const\",\"children\":[null,\"Post\"]},\"with_tags_cte\"]},\"order\",{\"type\":\"sym\",\"children\":[\"id\"]}]},\"pluck\",{\"type\":\"sym\",\"children\":[\"id\"]}]}]}]}","id":"0c8b7179-fdd1-4d76-8224-4a42ecf7cd72"}
{"repo_name":"gitlabhq","file_path":"./repos/gitlabhq/spec/support/shared_examples/services/boards/lists_move_service_shared_examples.rb","start_line":100,"raw_source":"def ordered_lists\n    board.lists.where.not(position: nil)\n  end","complexity_score":5.2,"ast_json":"{\"type\":\"def\",\"children\":[\"ordered_lists\",{\"type\":\"args\",\"children\":[]},{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[{\"type\":\"send\",\"children\":[null,\"board\"]},\"lists\"]},\"where\"]},\"not\",{\"type\":\"hash\",\"children\":[{\"type\":\"pair\",\"children\":[{\"type\":\"sym\",\"children\":[\"position\"]},{\"type\":\"nil\",\"children\":[]}]}]}]}]}","id":"083dc176-4a1e-4990-a27d-88c2d4c805fe"}
